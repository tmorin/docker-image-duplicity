image: debian/unstable
arch: amd64
environment:
  DEBIAN_FRONTEND: noninteractive
  duplicity_version: "0.8.12"
  prefix_version: ".1612"
  vcs_ref: "$TRAVIS_COMMIT"
  tag_image: "thibaultmorin/duplicity"
  tag_version: "$duplicity_version-$TRAVIS_CPU_ARCH"
  tag: "$tag_image:$tag_version"
sources:
  - https://github.com/tmorin/docker-image-duplicity.git
secrets:
  - e8346c50-7be9-477b-8a24-0be778941640
packages:
  - curl
  - docker.io
tasks:
  - configure: |
      mkdir -p .docker
      echo '{"experimental": "enabled"}' > .docker/config.json
      set +x
      echo '. ~/docker-hub.env' >> ~/.buildenv
      echo "DOCKER_PASSWORD" | docker --config .docker login -u "$DOCKER_USERNAME" --password-stdin
      set -x
  - build: |
      cd docker-image-duplicity
      ./scripts/build.sh "${tag}" "duplicity"
